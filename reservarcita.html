<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Neuropsicóloga Rodríguez — Reservar Cita</title>

  <!-- Favicon -->
  <link rel="icon" href="img/cerebro.png" type="image/jpeg"/>

  <!-- Fuente única: Raleway -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;700;800;900&display=swap" rel="stylesheet">
  <!-- Iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    :root{
      --blue-900:#002b5c;
      --blue-800:#003366;
      --blue-700:#004a99;
      --blue-600:#005bbf;
      --sky-100:#e6f2ff;
      --sky-50:#f3f8ff;
      --white:#ffffff;
      --shadow:0 14px 30px rgba(0,0,0,.12);
      --radius:18px;
    }
    *{box-sizing:border-box}

    /* ===== BASE ===== */
    body{
      margin:0;
      font-family:'Raleway',sans-serif;
      background:linear-gradient(135deg,var(--sky-100),#fff);
      color:var(--blue-800);
      overflow-x:hidden;
    }
    a{color:inherit}

    /* ===== HEADER (idéntico al modelo) ===== */
    header{
      position:sticky;top:0;z-index:1000;
      background:linear-gradient(90deg,var(--blue-900),var(--blue-700));
      color:#fff;
      padding:14px 20px; /* <- como el modelo */
      box-shadow:var(--shadow);
    }
    .topbar{
      max-width:1200px;margin:auto;
      display:flex;align-items:center;gap:14px;justify-content:space-between;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .brand h1{font-size:26px;margin:0;letter-spacing:.6px} /* <- como el modelo */
    /* Iconos sociales en el header (idénticos al modelo) */
    .quick{display:flex;gap:10px;opacity:.95}
    .quick a.social{
      display:inline-grid;place-items:center;
      width:36px;height:36px;border-radius:999px;
      background:rgba(255,255,255,.14);
      border:1.5px solid rgba(255,255,255,.28);
      color:#fff;text-decoration:none;
      transition:.25s;font-size:16px
    }
    .quick a.social:hover{background:#66b3ff;color:#002244}

    /* ===== NAV (idéntico al modelo) ===== */
    nav{background:var(--blue-800)}
    .navlinks{
      max-width:1200px;margin:auto;
      display:flex;justify-content:center;gap:18px;
      padding:12px 0; /* <- como el modelo */
      flex-wrap:wrap
    }
    .navlinks a{
      color:#fff;text-decoration:none;background:rgba(255,255,255,.12);
      border:1.5px solid rgba(255,255,255,.28);border-radius:999px;
      padding:12px 20px; /* <- como el modelo */
      font-weight:800;font-size:1.04rem; /* <- como el modelo */
      transition:.3s;display:inline-flex;align-items:center;gap:8px
    }
    .navlinks a:hover{background:#66b3ff;color:#002244}

    /* ===== Punto verde “Cortexa” (más chillón y notorio) ===== */
    .navlinks a.cx-live{display:inline-flex;align-items:center;gap:8px}
    .navlinks a.cx-live .cx-dot{
      width:10px;height:10px;border-radius:50%;
      background:#00ff40e7;                    /* verde CHILLÓN */
      box-shadow:0 0 10px rgba(0,255,106,.75);/* brillo más fuerte */
      margin-right:0;                         /* pegado al texto */
      position:relative;
      animation:pulseDot 2.5s ease-in-out infinite; /* latido lento */
      transform-origin:center center;
    }
    .navlinks a.cx-live .cx-dot::after{
      content:"";position:absolute;inset:-6px;border-radius:inherit;
      background:rgba(0,255,106,.28);         /* halo exterior */
      filter:blur(2px);
    }
    @keyframes pulseDot{
      0%   { transform:scale(1.00); box-shadow:0 0 10px rgba(0,255,106,.75); }
      45%  { transform:scale(0.82); box-shadow:0 0 6px  rgba(0,255,106,.50); }
      100% { transform:scale(1.00); box-shadow:0 0 10px rgba(0,255,106,.75); }
    }

    /* ===== CONTENIDO ===== */
    .content-container{padding:50px 0}

    h2{
      text-align:center;color:#fff;background:linear-gradient(90deg,#304d72,#003366);
      padding:14px 22px;border-radius:999px;width:fit-content;margin:28px auto 18px;
      box-shadow:var(--shadow);font-size:2.0em;letter-spacing:.5px;border:1px solid rgba(255,255,255,.45);
    }

    /* ===== LOGIN BOX + FORM ===== */
    .form-container{
      display:flex;justify-content:center;align-items:flex-start;
      margin:20px; padding:40px;
      background:linear-gradient(180deg,var(--sky-50) 0%, var(--sky-100) 100%);
      border:1.8px solid #cfe2ff;
      border-radius:22px;
      box-shadow: 0 10px 30px rgba(0,40,100,.08), inset 0 1px 0 rgba(255,255,255,.6);
      flex-direction:column; gap:18px;
      max-width:900px; margin-inline:auto;
    }

    .auth-row{
      display:flex;align-items:center;gap:14px;flex-wrap:wrap;
      background:#fff; border:1.5px solid #cfe2ff; border-radius:14px; padding:12px 14px;
      box-shadow:0 6px 14px rgba(0,0,0,.06);
    }
    .auth-status{font-size:.95rem;color:#24415f}
    .chip{
      background:#eef6ff;border:1px solid #cde3ff;color:#003a7a;
      padding:6px 10px;border-radius:999px;font-size:.9rem
    }
    .signout-btn{
      border:none;border-radius:999px;padding:10px 14px;font-weight:700;cursor:pointer;
      background:#f0f5ff;border:1px solid #cfe2ff;color:#003a7a;
    }

    form{
      display:flex;flex-direction:column;gap:16px;
      width:100%;max-width:700px;
    }
    label{font-size:1.05em;color:var(--blue-800)}
    input, textarea, select{
      padding:12px 12px; font-size:1rem;
      border:2px solid #cfe2ff;
      border-radius:14px; width:100%;
      background:#f9fcff;
      outline:none;
      transition:border-color .2s, box-shadow .2s, background-color .2s;
      font-family:'Raleway',sans-serif;
      box-shadow: inset 0 1px 2px rgba(0,0,0,.03);
    }
    input::placeholder, textarea::placeholder{color:#7a93b2;opacity:.9}
    input:focus, textarea:focus, select:focus{
      border-color:#66aaff;background:#ffffff;box-shadow:0 0 0 4px rgba(102,170,255,.18);
    }
    textarea{min-height:140px; resize:vertical}

    .btn-submit{
      border:none;border-radius:999px;padding:14px 22px;
      font-weight:800;cursor:pointer;box-shadow:0 10px 24px rgba(0,0,0,.18);
      background:#66aaff;color:#002244;font-size:1.1rem;
      display:inline-flex;align-items:center;gap:10px;justify-content:center;
    }
    .btn-submit[disabled]{opacity:.55;cursor:not-allowed;box-shadow:none}
    .btn-submit:hover:not([disabled]){transform:translateY(-2px)}

    footer{
      background:var(--blue-800);color:#fff;text-align:center;
      padding:18px;margin-top:24px;box-shadow:0 -6px 18px rgba(0,0,0,.06)
    }

    /* Responsive (mismo ajuste del modelo en nav) */
    @media (max-width:900px){
      .brand h1{font-size:24px}
      .navlinks{gap:16px;padding:10px 0}
      .navlinks a{font-size:1.04rem;padding:12px 18px}
    }
    @media (max-width:640px){
      .form-container{padding:28px}
    }
  </style>
</head>
<body>
  <!-- ====== AUDIO DE FONDO (Aftonland.mp3) ====== -->
  <audio id="site-bgm" preload="auto" loop playsinline style="display:none" aria-hidden="true">
    <source src="Aftonland.mp3" type="audio/mpeg">
  </audio>
  <script>
    // No autoplay: el usuario debe presionar el botón. Volumen inicial 75%.
    document.addEventListener('DOMContentLoaded', () => {
      const bgm = document.getElementById('site-bgm');
      if (!bgm) return;
      bgm.volume = 0.3;
    });
  </script>
  <!-- ====== FIN AUDIO ====== -->

  <!-- ===== HEADER (copiado tal cual del modelo) ===== -->
  <header>
    <div class="topbar">
      <div class="brand">
        <h1>Neuropsicóloga Rodríguez</h1>
      </div>
      <div class="quick">
        <!-- Iconos sociales -->
        <a class="social" href="https://www.facebook.com/share/1Av2BgPo17/" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fab fa-facebook-f" aria-hidden="true"></i>
        </a>
        <a class="social" href="https://www.instagram.com/neuropsicologa_rodriguez_?igsh=NWZnNnphZTIzNWN6" target="_blank" rel="noopener" aria-label="Instagram">
          <i class="fab fa-instagram" aria-hidden="true"></i>
        </a>
      </div>
    </div>
  </header>

  <!-- ===== NAV (copiado tal cual del modelo, con punto en Cortexa) ===== -->
  <nav>
    <div class="navlinks">
      <a href="index.html"><i class="fas fa-home" aria-hidden="true"></i> Inicio</a>
      <a href="sobremi.html"><i class="fas fa-user" aria-hidden="true"></i> Sobre Mí</a>

      <!-- Cortexa con punto verde animado a la izquierda -->
      <a href="cortexa.html" class="cx-live">
        <span class="cx-dot" aria-hidden="true"></span> Cortexa
      </a>

      <a href="especialidades.html"><i class="fas fa-brain" aria-hidden="true"></i> Especialidades</a>
      <a href="reservarcita.html"><i class="fas fa-calendar-check" aria-hidden="true"></i> Reservar Cita</a>
    </div>
  </nav>

  <!-- ===== CONTENIDO ===== -->
  <div class="content-container">
    <section>
      <h2>Reserve su cita</h2>

      <div class="form-container">

        <!-- Bloque de autenticación -->
        <div class="auth-row">
          <div id="g_id_onload"
               data-client_id="958625942227-fi3vs6se8li3q94m1mn6fju4c3pkcpmj.apps.googleusercontent.com"
               data-callback="handleCredentialResponse"
               data-context="signin"
               data-auto_prompt="false">
          </div>
          <div class="g_id_signin"
               data-type="standard"
               data-size="large"
               data-theme="outline"
               data-text="sign_in_with"
               data-shape="pill"
               data-logo_alignment="left">
          </div>

          <span class="auth-status" id="authStatus">Debes iniciar sesión con Google para enviar la reserva.</span>
          <span class="chip" id="userChip" style="display:none;"></span>
          <button class="signout-btn" id="signOutBtn" type="button" style="display:none;">Salir</button>
        </div>

        <!-- Formulario -->
        <form id="reservaForm" action="https://formsubmit.co/neuropsicologarodriguez@gmail.com" method="POST">
          <label for="nombre">Nombre Completo:</label>
          <input type="text" id="nombre" name="nombre" placeholder="Tu nombre y apellidos" required>

          <label for="telefono">Número de Teléfono:</label>
          <input type="tel" id="telefono" name="telefono" placeholder="Ej.: 999 999 999" required>

          <label for="email">Correo Electrónico:</label>
          <input type="email" id="email" name="email" placeholder="tucorreo@ejemplo.com" required>

          <label for="servicio">Seleccionar Servicio:</label>
          <select id="servicio" name="servicio" required>
            <option value="Evaluación Neuropsicológica">Evaluación Neuropsicológica</option>
            <option value="Evaluación Psicológica">Evaluación Psicológica</option>
            <option value="Orientación Vocacional">Orientación Vocacional</option>
            <option value="Psicoterapia Cognitiva-Conductual">Psicoterapia cognitiva-conductual</option>
            <option value="Psicoterapia Familiar y de Pareja">Psicoterapia familiar y de pareja</option>
            <option value="Escuela de Padres">Escuela de padres</option>
            <option value="Talleres y Capacitaciones">Talleres y capacitaciones</option>
          </select>

          <label for="mensaje">Mensaje Adicional:</label>
          <textarea id="mensaje" name="mensaje" placeholder="Cuéntame brevemente el motivo de tu consulta..." required></textarea>

          <!-- Campos ocultos con datos del login -->
          <input type="hidden" name="login_email" id="login_email">
          <input type="hidden" name="google_id_token" id="google_id_token">

          <!-- Honeypot anti-bots (no llenar) -->
          <input type="text" name="_honey" style="display:none">

          <button id="submitBtn" type="submit" class="btn-submit" disabled>
            <i class="fas fa-paper-plane" aria-hidden="true"></i> Reservar Cita
          </button>

          <!-- FormSubmit config -->
          <input type="hidden" name="_next" value="http://127.0.0.1:5500/index.html">
          <input type="hidden" name="_captcha" value="false">
        </form>
      </div>
    </section>
  </div>

  <footer>
    <p>&copy; 2025 Neuropsicóloga Rodríguez</p>
  </footer>

  <!-- ===== Script del botón de audio (play/pause con icono y texto) ===== -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const bgm = document.getElementById('site-bgm');
      const btn = document.getElementById('audioToggle'); // puede no existir
      if (!bgm || !btn) return;

      const icon = btn.querySelector('i');
      const labelSpan = btn.querySelector('.nav-audio-text');

      const setState = (playing) => {
        btn.setAttribute('aria-pressed', playing ? 'true' : 'false');
        const label = playing ? 'Pausar música relajante' : 'Reproducir música relajante';
        btn.setAttribute('aria-label', label);
        btn.title = label;
        if (labelSpan) labelSpan.textContent = label;
        icon.className = playing ? 'fas fa-pause' : 'fas fa-play';
      };

      // Estado inicial: música detenida hasta que el usuario presione el botón
      setState(false);

      // Sincroniza si cambia fuera del botón
      bgm.addEventListener('play',  () => setState(true));
      bgm.addEventListener('pause', () => setState(false));

      // Toggle
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        if (bgm.paused) {
          bgm.play().then(() => setState(true)).catch(() => {});
        } else {
          bgm.pause();
          setState(false);
        }
      });
    });
  </script>

  <script>
    // Decodifica el JWT para obtener el email/nombre
    function decodeJwtResponse(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
        '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
      ).join(''));
      return JSON.parse(jsonPayload);
    }

    // Callback de Google Identity
    function handleCredentialResponse(resp) {
      try{
        const payload = decodeJwtResponse(resp.credential);
        const email = payload.email || '';
        const name  = payload.name  || '';
        // Rellena campos ocultos
        document.getElementById('login_email').value = email;
        document.getElementById('google_id_token').value = resp.credential;
        // Marca visual y habilita envío
        const chip = document.getElementById('userChip');
        chip.textContent = name ? (name + ' • ' + email) : email;
        chip.style.display = 'inline-block';
        document.getElementById('authStatus').textContent = 'Sesión iniciada con Google.';
        document.getElementById('signOutBtn').style.display = 'inline-block';
        document.getElementById('submitBtn').disabled = false;

        // También pre-llena el campo email del formulario si está vacío
        const emailInput = document.getElementById('email');
        if(email && !emailInput.value) emailInput.value = email;
      }catch(e){
        console.error(e);
        alert('Hubo un problema con el inicio de sesión. Inténtalo otra vez.');
      }
    }

    // "Cerrar sesión" (solo limpia el estado del front)
    document.getElementById('signOutBtn').addEventListener('click', () => {
      document.getElementById('login_email').value = '';
      document.getElementById('google_id_token').value = '';
      document.getElementById('userChip').style.display = 'none';
      document.getElementById('authStatus').textContent = 'Debes iniciar sesión con Google para enviar la reserva.';
      document.getElementById('signOutBtn').style.display = 'none';
      document.getElementById('submitBtn').disabled = true;
    });

    // Evita envío si no hay login (doble seguridad en front)
    document.getElementById('reservaForm').addEventListener('submit', (e) => {
      const tok = document.getElementById('google_id_token').value;
      if(!tok){
        e.preventDefault();
        alert('Por favor, inicia sesión con Google antes de enviar.');
      }
    });
  </script>
</body>
</html>
